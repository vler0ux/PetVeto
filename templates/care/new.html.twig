{% extends 'base.html.twig' %}

{% block title %}Nouveau soin - PetVeto{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="mb-4">ü©∫ Ajouter un nouveau soin</h1>

    {% if form.vars.data.animal %}
        {% if lastVaccinationDate %}
            <div class="alert alert-info text-center">
                üíâ Derni√®re vaccination de <strong>{{ form.vars.data.animal.name }}</strong> :
                <span class="fw-semibold">{{ lastVaccinationDate|date('d/m/Y') }}</span>
            </div>
        {% else %}
            <div class="alert alert-warning text-center">
                ‚ö†Ô∏è Aucun vaccin renseign√© pour <strong>{{ form.vars.data.animal.name }}</strong>.
            </div>
        {% endif %}
    {% endif %}

    {{ form_start(form) }}
       {{ include('care/_form.html.twig', { form: form }) }}
        <div class="d-flex gap-2 mt-3">
            <button type="submit" class="btn btn-primary">‚úÖ Enregistrer le soin</button>
            <a href="{{ path('app_home') }}" class="btn btn-secondary">‚¨ÖÔ∏è Retour √† l‚Äôaccueil</a>
        </div>
    {{ form_end(form) }}

    {% if form.veto is defined and form.veto.vars.choices is empty %}
        <div class="alert alert-warning mt-4 text-center">
            ‚ö†Ô∏è Aucun v√©t√©rinaire enregistr√©.<br>
            <a href="{{ path('veto_new') }}" class="btn btn-outline-primary mt-2">
                ‚ûï Ajouter un v√©t√©rinaire
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log("JS ex√©cut√© ‚úÖ");

            const toggleField = (selectField, containerId) => {
                const container = document.getElementById(containerId);

                const checkVisibility = () => {
                    console.log("Valeur de", selectField.name, "=", selectField.value);
                    if (selectField.value === "autre") {
                        container.style.display = "block";
                    } else {
                        container.style.display = "none";
                        const input = container.querySelector("input");
                        if (input) input.value = "";
                    }
                };

                if (selectField && container) {
                    checkVisibility();
                    selectField.addEventListener("change", checkVisibility);
                }
            };

            toggleField(document.querySelector("[name='care[type]']"), "customCareTypeContainer");
            toggleField(document.querySelector("[name='care[food]']"), "customFoodContainer");
            toggleField(document.querySelector("[name='care[behaviour]']"), "customBehaviourContainer");
        });
    </script>
{% endblock %}


